<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>리듬 턴제 격투기 게임</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            text-align: center;
            padding: 50px;
        }
        .button {
            margin: 10px;
            padding: 15px 30px;
            font-size: 16px;
            cursor: pointer;
        }
        #result {
            margin-top: 20px;
            font-size: 24px;
        }
        #hp {
            margin-top: 20px;
            font-size: 20px;
        }
        #note {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 50px;
            background-color: red;
            display: none;
        }
    </style>
</head>
<body>

<h1>리듬 턴제 격투기 게임</h1>
<button class="button" id="punch">펀치</button>
<button class="button" id="guard">가드</button>
<button class="button" id="restart" style="display: none;">다시하기</button>

<div id="result"></div>
<div id="hp">플레이어 HP: 3 | 컴퓨터 HP: 3</div>
<div id="note"></div>

<audio id="bg-music" src="background.mp3" loop></audio>

<script>
    let playerHP = 3;
    let computerHP = 3;
    const resultDisplay = document.getElementById('result');
    const hpDisplay = document.getElementById('hp');
    const bgMusic = document.getElementById('bg-music');
    let noteActive = false;
    let currentAction = null;

    function computerAttack() {
        const damage = Math.floor(Math.random() * 2) + 1; // 1 또는 2의 피해량
        playerHP -= damage;
        resultDisplay.innerHTML += `<br>컴퓨터가 공격하여 ${damage}의 피해를 줬습니다!`;
    }

    function updateHP() {
        hpDisplay.innerHTML = `플레이어 HP: ${playerHP} | 컴퓨터 HP: ${computerHP}`;
        if (playerHP <= 0) {
            resultDisplay.innerHTML += "<br>게임 오버! 컴퓨터가 이겼습니다!";
            disableButtons();
        } else if (computerHP <= 0) {
            resultDisplay.innerHTML += "<br>축하합니다! 당신이 이겼습니다!";
            disableButtons();
        }
    }

    function disableButtons() {
        noteActive = false;
        document.getElementById('restart').style.display = 'block'; // 다시하기 버튼 표시
    }

    function resetGame() {
        playerHP = 3;
        computerHP = 3;
        resultDisplay.innerHTML = '';
        hpDisplay.innerHTML = `플레이어 HP: ${playerHP} | 컴퓨터 HP: ${computerHP}`;
        document.getElementById('restart').style.display = 'none'; // 다시하기 버튼 숨기기
        bgMusic.currentTime = 0; // 음악을 처음으로 돌립니다.
        bgMusic.play(); // 음악 재생
        startTurn();
    }

    function startTurn(action) {
        currentAction = action;
        if (action === "punch") {
            dropNote(); // 펀치를 선택했을 때 노트를 떨어뜨림
        } else {
            // 가드를 선택하면 노트는 떨어지지 않음
            computerAttack(); // 가드 후 컴퓨터가 공격
            updateHP();
        }
    }

    function dropNote() {
        const note = document.getElementById('note');
        note.style.display = 'block';
        note.style.top = '-50px';
        let position = -50; // 노트 시작 위치

        const interval = setInterval(() => {
            if (position >= window.innerHeight) {
                clearInterval(interval);
                note.style.display = 'none';
                noteActive = false;
                computerAttack(); // 노트를 맞추지 못했을 때 컴퓨터 공격
                updateHP();
                startTurn(null); // 다음 턴 시작
            } else {
                position += 5; // 노트가 내려가는 속도
                note.style.top = position + 'px';
            }
        }, 20);
    }

    function hitNote() {
        if (noteActive) {
            const damage = Math.floor(Math.random() * 2) + 1; // 1 또는 2의 피해량
            computerHP -= damage;
            resultDisplay.innerHTML = `당신이 공격하여 ${damage}의 피해를 줬습니다!`;
            updateHP();
            document.getElementById('note').style.display = 'none';
            noteActive = false;
            startTurn(null); // 다음 턴 시작
        }
    }

    document.getElementById('punch').addEventListener('click', () => {
        noteActive = true;
        startTurn("punch");
    });

    document.getElementById('guard').addEventListener('click', () => {
        startTurn("guard");
    });

    document.getElementById('restart').addEventListener('click', resetGame);

    // 게임 시작 시 배경 음악 재생
    window.onload = function() {
        bgMusic.play();
        resetGame(); // 게임을 초기화하고 시작
    };
</script>

</body>
</html>
